<!DOCTYPE html>
<html lang="en">
<head>
          <title></title>
	    <link href='https://lovedboy.github.io/theme/css/notsobad.css' rel='stylesheet' type='text/css'>


        <meta charset="utf-8" />
        <link href="https://lovedboy.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title=" Full Atom Feed" />
        <link href="https://lovedboy.github.io/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title=" Categories Atom Feed" />




</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://lovedboy.github.io/"> <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/">home</a></li>
            <li><a href="/">links</a></li>
            <li><a href="/">about</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://lovedboy.github.io/blog/1970/01/01/ping.html" rel="bookmark"
         title="Permalink to ping">ping</a>
		 
    <abbr class="published" title="1970-01-01T00:00:00+08:00">
      1970-01-01 00:00
    </abbr>
		 </h2>
 
  </header>
    <div class="entry-content">
    <h2>原理</h2>
<p>ping 是用来测试数据包能否通过ip协议到达指定主机的网络工具。原理是向目的主机发出一个<code>ICMP echo</code>请求，并等待响应数据包。</p>
<p>值得注意是：发送端发送的选项数据，服务端必须回显。</p>
<p>ICMP echo 报文格式：</p>
<p><img alt="" src="http://ww3.sinaimg.cn/large/79565610jw1f1adgxrwc8j21ao0iqmy4.jpg"></p>
<h2>输出解读</h2>
<p>看一个ping结果的输出截图:</p>
<p><img alt="" src="http://ww3.sinaimg.cn/large/79565610jw1f1ads0kc1ij20sq08uwh1.jpg"></p>
<h3>报文大小</h3>
<p>图片中的64bytes是ICMP报文的大小，不包括IP头部。可以通过<code>-s</code> 选项来指定<code>选项数据</code>大小。</p>
<h3>icmp_seq</h3>
<p>ICMP报文序号。序号从0开始，每发送一个请求，序号加1。</p>
<h3>ttl</h3>
<p>来源于ICMP应答报文的IP头部的ttl字段，可以用来计算报文经过了多少个路由器。</p>
<p>根据图片可以看出应答报文经过了<code>64-56=8</code>个路由器中继。</p>
<h3>time</h3>
<p>报文的往返时间。ping程序通过在ICMP报文数据中存放发送请求的时间来计算往返时间。当应答报文返回时，用当前时间减去存放在报文的时间值，就是往返时间。</p>
<p>如果要在ping结果中显示time统计，ICMP报文选项数据部分至少需要多大？</p>
<p>答案是16。因为<code>struct timeval</code>的长度是16，所以报文选项数据部分至少有16个bytes才能放得下timeval结构图。</p>
<p><img alt="" src="http://ww3.sinaimg.cn/large/79565610jw1f1aebza3hvj20oc05it9z.jpg"></p>
<p>可以看出15个bytes是没有时间统计输出的。</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                By <a href="http://github.com/lovedboy" target="_blank">@lovedb0y</a>
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>