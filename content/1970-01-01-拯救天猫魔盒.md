title: 拯救天猫魔盒
date: 1970-01-01
comments: true
categories: 
由于众所周知的原因，天猫魔盒升级后删除了所有的非官方视频播放软件。重新安装后软件会被秒删，或者重启后会被清理，这后门留的。少了这些非官方的视频播放软件，盒子基本就成一块板砖了，无奈开启盒子拯救之路。

1, **首先将盒子恢复出厂设置，为的是降级处理。**

2, **配置dns服务器，屏蔽阿里系的所有域名。**

因为盒子的网络配置是可以指定dns服务器的，为了快速屏蔽阿里系的所有域名，考虑为盒子搭建一个dns服务器。
我用的[dnsmasq](https://wiki.archlinux.org/index.php/Dnsmasq)，安装完成后在配置文件中添加下列文件。

```
listen-address= your-ip
address=/.aliyun.com/127.0.0.1
address=/.yunos.com/127.0.0.1
address=/.taobao.com/127.0.0.1
address=/.alipay.com/127.0.0.1
address=/.wasu.tv/127.0.0.1
address=/.alipay-inc.com/127.0.0.1
address=/.alibaba.com/127.0.0.1
server=119.29.29.29
```
3, **屏蔽ip**

屏蔽域名还不能完全起作用，盒子的升级请求可能通过请求固定ip来控制的，这方面我就没有抓包了。在贴吧上看到需要屏蔽下面三个ip才能完全起作用。于是在路由器上面针对盒子添加了几条上网控制规则。

```
140.205.172.1
42.120.158.67
42.156.141.75
```
